{% extends "base.html" %}
{% block title %}Box: {{ box.name }}{% endblock %}

{% block content %}
<h2>📦 Box: {{ box.name }}</h2>
<p><a href="/">⬅️ Zurück zur Übersicht</a></p>

<form method="post" action="/box/{{ box.id }}/add-item" class="add-item-form button-group">
  <input type="text" name="name" placeholder="Neuer Gegenstand" required>
  <input type="number" name="quantity" value="1" min="1">
  <input type="text" name="category" placeholder="Kategorie (optional)">
  <button type="submit">➕ Hinzufügen</button>
</form>

<div class="sort-options">
  <label for="sort-items"><b>Sortieren nach:</b></label>
  <select id="sort-items" onchange="sortItems()">
    <option value="last_updated">Zuletzt geändert (neueste zuerst)</option>
    <option value="name">Name (A–Z)</option>
    <option value="quantity">Stückzahl (absteigend)</option>
  </select>
</div>

<ul id="item-list" class="item-list">
  {% for item in box.items %}
    <li class="item-card"
        data-name="{{ item.name | lower }}"
        data-quantity="{{ item.quantity }}"
        data-updated="{{ item.last_updated.timestamp() if item.last_updated else 0 }}"
        id="item-{{ item.id }}">
      <div class="item-details">
        <div class="item-name">{{ item.name }}</div>
        {% if item.category %}
          <div class="item-category">({{ item.category }})</div>
        {% endif %}
        {% if item.last_updated %}
          <div class="item-timestamp">
            🕓 {{ item.last_updated.strftime('%Y-%m-%d %H:%M') }}
          </div>
        {% endif %}
      </div>
      <div class="item-actions">
        <button onclick="changeQty({{ item.id }}, -1)">➖</button>
        <input id="qty-{{ item.id }}" type="number" value="{{ item.quantity }}" min="0" />
        <button onclick="changeQty({{ item.id }}, 1)">➕</button>
        <button onclick="setQty({{ item.id }})">✔️</button>
        <button onclick="openEditDialog({{ item.id }}, '{{ item.name|e }}', '{{ item.category|default('', True)|e }}')">✏️</button>
        <button onclick="deleteItem({{ item.id }})" class="danger">🗑️</button>
      </div>
    </li>
  {% else %}
    <li>Diese Box ist leer.</li>
  {% endfor %}
</ul>

<div id="editDialog" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(30,30,30,0.8); z-index:99; align-items:center; justify-content:center;">
  <form id="editForm" style="background:#232323; color:#eee; padding:2rem; border-radius:1rem; box-shadow:0 0 1.5rem #000; min-width:280px; max-width:95vw;">
    <h3>Eintrag bearbeiten</h3>
    <input type="hidden" name="edit_id" id="edit_id">
    <div style="margin-bottom:1em;">
      <label>Name:<br>
        <input type="text" name="edit_name" id="edit_name" required style="width:100%">
      </label>
    </div>
    <div style="margin-bottom:1em;">
      <label>Kategorie:<br>
        <input type="text" name="edit_category" id="edit_category" style="width:100%">
      </label>
    </div>
    <div style="display:flex; gap:1em; margin-top:1em;">
      <button type="submit">Speichern</button>
      <button type="button" onclick="closeEditDialog()">Abbrechen</button>
    </div>
  </form>
</div>


{% endblock %}
