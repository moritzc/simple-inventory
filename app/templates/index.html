{% extends "base.html" %}

{% block title %}Inventar Übersicht{% endblock %}

{% block content %}
<h2>Inventar Übersicht</h2>

<div class="button-group">
    <form method="get" action="/" class="search-form">
        <input type="text" name="q" placeholder="🔍 Suche z.B. HDMI, Kabel..." value="{{ q }}">
        <button type="submit">Suchen</button>
    </form>
    <form method="post" action="/create-box" class="create-box-form">
        <input type="text" name="name" placeholder="📦 Neue Box anlegen" required>
        <button type="submit">➕ Box hinzufügen</button>
    </form>
</div>

<div class="button-group">
    <a href="/export/json" class="button">⬇️ Export als JSON</a>
    <a href="/export/csv" class="button">⬇️ Export als CSV</a>
    <form method="post" action="/import" enctype="multipart/form-data" onsubmit="return confirm('Achtung: Der gesamte aktuelle Datenbestand wird gelöscht und durch die importierten Daten ersetzt. Vorgang fortsetzen?');">
        <input type="file" name="file" required>
        <button type="submit" class="button">⬆️ Import</button>
    </form>
</div>

<ul class="box-list">
  {% for entry in results %}
    <li class="box-list-item" id="box-{{ entry.box.id }}">
      <div class="box-name">
        <a href="/box/{{ entry.box.id }}">{{ entry.box.name }}</a>
        <span>({{ entry.box.items|length }} Inhalte)</span>
      </div>
      <div class="box-actions">
          <button onclick="openEditBoxDialog({{ entry.box.id }}, '{{ entry.box.name|e }}')">✏️ Bearbeiten</button>
          <form method="post" action="/box/{{ entry.box.id }}/delete" onsubmit="return confirm('Box wirklich löschen? Alle Inhalte werden entfernt.')">
            <button type="submit" class="danger">🗑️ Löschen</button>
          </form>
      </div>
      {% if entry.matches %}
        <ul class="search-matches">
          {% for item in entry.matches %}
            <li>{{ item.name }} ({{ item.quantity }})</li>
          {% endfor %}
        </ul>
      {% endif %}
    </li>
  {% else %}
    <li>Keine Boxen gefunden.</li>
  {% endfor %}
</ul>

<div id="editBoxDialog" class="modal">
  <div class="modal-content">
    <form id="editBoxForm">
      <h3>Box umbenennen</h3>
      <input type="hidden" name="edit_box_id" id="edit_box_id">
      <label for="edit_box_name">Neuer Name:</label>
      <input type="text" name="edit_box_name" id="edit_box_name" required>
      <div class="button-group">
        <button type="submit">Speichern</button>
        <button type="button" onclick="closeEditBoxDialog()">Abbrechen</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
